## 1. 实验概述

数字水印是一种将特定信息（如标识、版权信息、序列号等）嵌入到数字媒体（图像、音频、视频）中的技术，旨在实现版权保护、泄露追踪、完整性验证等目的。本实验实现了一个**基于离散余弦变换（DCT）的图像水印系统**，可完成水印的嵌入、提取，并进行鲁棒性测试（翻转、平移、裁剪、对比度变化、加噪声等攻击）。

本实验采用**中频系数嵌入法**，在不明显影响图像感知质量的前提下，提高水印的抗攻击能力。

------

## 2. 实现原理

### 2.1 离散余弦变换（DCT）

DCT 是一种常用的图像变换方法，能将空间域的像素值转换到频域表示：

- 低频系数：表示图像的整体亮度和轮廓
- 高频系数：表示细节和噪声
- 中频系数：位于低频和高频之间，对人眼感知不敏感，但在常见图像处理攻击中不易被破坏

由于人眼对中频区域的改变不敏感，且中频系数在压缩、滤波等操作中相对稳定，因此选择在中频系数中嵌入水印信息。

------

### 2.2 水印嵌入过程

1. **图像预处理**：
    将原始载体图像（Cover Image）转换为灰度图，并划分为若干个 **8×8** 的小块。
2. **DCT变换**：
    对每个块进行二维 DCT，得到对应的频域系数矩阵。
3. **选择中频系数对**：
    选取两个中频位置（如 `(2,3)` 与 `(3,2)`）作为嵌入位的承载位置。
4. **嵌入规则**（差值调制法）：
   - 若水印位为 `1`，调整系数使得 `C(2,3) > C(3,2)`，且差值大于设定阈值 `α`
   - 若水印位为 `0`，调整系数使得 `C(2,3) < C(3,2)`，且差值大于 `α`
5. **IDCT反变换**：
    对修改后的系数块进行二维逆DCT，重构图像块，并拼接成完整的嵌入水印后的图像（Stego Image）。
6. **密钥控制块顺序**：
    使用伪随机数生成器（PRNG）对块的顺序打乱，实现密钥控制的水印位置分布，提升安全性。

------

### 2.3 水印提取过程

1. 将含水印图像分成同样的 **8×8** 块。
2. 对每个块做 DCT，读取相同位置的两个中频系数 `(2,3)` 与 `(3,2)`。
3. 判断：
   - 若 `C(2,3) > C(3,2)` → 水印位为 `1`
   - 若 `C(2,3) < C(3,2)` → 水印位为 `0`
4. 组合所有位得到二值水印图像。

> 由于本实验实现的是**半盲检测**（需要知道原水印尺寸和嵌入参数），提取时不需要原始载体图像。

------

### 2.4 鲁棒性测试原理

为了验证水印的鲁棒性，需要模拟常见的图像处理攻击，包括：

- **几何攻击**：水平/垂直翻转、平移、裁剪
- **像素值攻击**：改变对比度、亮度
- **噪声攻击**：加高斯噪声

在攻击后的图像中提取水印，并与原水印比较**归一化相关系数（Normalized Correlation, NC）**：
$$
NC = \frac{\sum_i (W_i - \overline{W})(W'_i - \overline{W'})}
{\sqrt{\sum_i (W_i - \overline{W})^2} \cdot \sqrt{\sum_i (W'_i - \overline{W'})^2}}
$$


- NC≈1 表示提取水印与原水印高度一致
- NC≈0 表示无关

------

