# project 1
## task
1、实现sm4基本加解密。<br>
2、从以下几个方面进行优化: T-table优化，AES-NI类似指令集优化，最近SIMD指令集<br>
3、SM4-GCM模式实现及优化
## 一、SM4基本实现
### 基本参数
分组长度： 128位（16字节）。每次处理一个128位的明文/密文分组。<br>
密钥长度： 128位（16字节）。<br>
结构： 非平衡Feistel网络。与DES类似，但轮函数作用于整个128位状态的左半部分（64位），然后与右半部分进行异或。<br>
轮数： 32轮。经过32轮相同的迭代操作（轮函数）进行加密或解密。<br>
安全性： 设计目标提供128位的安全强度。至今未发现有效的实际攻击（如线性攻击、差分攻击等能显著降低其安全强度）。<br>
### 加密过程
输入：<br>
明文分组 P (128位)<br>
加密密钥 MK (128位)<br>
密钥扩展： 使用 MK 生成 32个轮密钥 (rk₀, rk₁, ..., rk₃₁) (每个32位)。这是算法的关键预处理步骤。<br>
初始变换：<br>
将128位明文 P 拆分成4个32位字：P = (X₀, X₁, X₂, X₃)<br>
执行一个初始异或操作（使用系统参数 FK）：<br>
(X₀, X₁, X₂, X₃) = (X₀ ⊕ FK₀, X₁ ⊕ FK₁, X₂ ⊕ FK₂, X₃ ⊕ FK₃)<br>
FK₀ = 0xA3B1BAC6<br>
FK₁ = 0x56AA3350<br>
FK₂ = 0x677D9197<br>
FK₃ = 0xB27022DC<br>
32轮迭代：<br>
对于每一轮 i = 0 到 31：<br>
X_{i+4} = X_i ⊕ T(X_{i+1} ⊕ X_{i+2} ⊕ X_{i+3} ⊕ rk_i)<br>
其中 T(·) 是一个可逆合成变换（核心非线性部分），由两个子变换组成：T(·) = L(τ(·))<br>
τ(·)：非线性字节替换（S盒）。将输入的32位字拆分成4个字节，每个字节独立地通过一个固定的8位输入8位输出的S盒进行替换。SM4的S盒设计基于有限域上的仿射变换，具有良好的非线性特性和差分均匀性，是算法安全的关键。S盒的具体值在标准中定义。<br>
L(·)：线性扩散变换。对τ(·)输出的32位字进行一个线性变换，提供扩散性。定义为：<br>
L(B) = B ⊕ (B <<< 2) ⊕ (B <<< 10) ⊕ (B <<< 18) ⊕ (B <<< 24)（<<< 表示循环左移）<br>
rk_i：第 i 轮的轮密钥（32位）。<br>
反序变换：<br>
经过32轮迭代后，得到 (X₃₂, X₃₃, X₃₄, X₃₅)<br>
对输出顺序进行反转：<br>
(Y₀, Y₁, Y₂, Y₃) = (X₃₅, X₃₄, X₃₃, X₃₂)<br>
输出： 将 (Y₀, Y₁, Y₂, Y₃) 拼接成128位密文分组 C。<br>
## 解密过程
由于使用了feistel结构，所以解密和加密使用的是完全相同的结构，唯一的区别是轮密钥的使用顺序相反。
<img width="1112" height="621" alt="image" src="https://github.com/user-attachments/assets/b4c6aa63-814a-46b9-9722-af5057bda081" />
